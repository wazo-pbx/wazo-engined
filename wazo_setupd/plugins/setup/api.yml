paths:
  /setup:
    get:
      summary: Get the engine setup status
      operationId: get_setup_status
      description: |
        Get information from the engine to know if it's already configured and
        if the necessary service for its completion are running.
      tags:
        - setup
      responses:
        '200':
          description: Engine setup status
          schema:
            $ref: '#/definitions/SetupConfigured'

    post:
      summary: Setup the Wazo Engine
      operationId: create
      parameters:
        - $ref: '#/parameters/SetupBody'
      tags:
        - setup
      responses:
        '201':
          description: The setup has been completed
        '400':
          $ref: '#/responses/InvalidRequest'
        '500':
          $ref: '#/responses/SetupError'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
definitions:
  SetupRequest:
    type: object
    properties:
      engine_language:
        description: The interface language for the Wazo Engine (either `en_US` or `fr_FR`)
        type: string
      engine_password:
        description: Password of the first administrator ``root`` on the engine
        type: string
      engine_internal_address:
        description: IP address of the engine
        type: string
      engine_license:
        description: Whether the GNU GPLv3 license is accepted
        type: boolean
      engine_instance_uuid:
        description: |
          The UUID identifying this instance on Nestbox.

          The engine_instance_uuid should only be specified if the instance has already been registered on the specified Nestbox. Omitting this field for an instance that is already registered will create a duplicate entry on the Nestbox.
        type: string
      nestbox_host:
        description: Host of the Nestbox where the engine will register. Specifying this key will make nestbox and `engine_internal_address` keys mandatory. Wazo will be connected to the specified Nestbox instance.
        type: string
      nestbox_port:
        description: Port of the Nestbox where the engine will register
        type: integer
        default: 443
      nestbox_verify_certificate:
        description: Should the certificate used for HTTPS be verified? The setup will abort if the certificate fails the verification.
        type: boolean
        default: true
      nestbox_service_id:
        description: Nestbox username used to register the engine
        type: string
      nestbox_service_key:
        description: Nestbox password used to register the engine
        type: string
      nestbox_instance_name:
        description: Name of the engine in Nestbox
        type: string
      nestbox_engine_host:
        description: Host used by Nestbox to contact the engine
        type: string
      nestbox_engine_port:
        description: Port used by Nestbox to contact the engine
        type: integer
        default: 443
    required:
      - engine_language
      - engine_password
      - engine_license
  SetupConfigured:
    title: SetupConfigured
    properties:
      configured:
        type: boolean
        description: Whether Wazo has already been configured or not
      provd_ready:
        type: boolean
        description: Whether wazo-provd is ready to receive requests or not

parameters:
  SetupBody:
    name: body
    in: body
    required: true
    description: Setup options
    schema:
      $ref: '#/definitions/SetupRequest'
responses:
  SetupError:
    description: A error occurred during the setup
    schema:
      $ref: '#/definitions/Error'
